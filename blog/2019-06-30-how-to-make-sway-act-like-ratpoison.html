<!DOCTYPE html>
<html lang="en">
  <head>
    <title>How to make sway act like ratpoison</title>
    <link rel="stylesheet" href="../css/default.css" type="text/css" media="screen" title="default">
    <link rel="stylesheet" href="../css/syntax.css" type="text/css">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="description" content="Troels Henriksen's piece of the web.  Mostly about programming.">
    <meta name="keywords" content="Braintwist, Brainfuck, Lisp, Common Lisp Troels Henriksen, Brainfork, Esoteric programming language, programming, Haskell, functional programming, Futhark">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
  </head>
  <body>
    <div id="header">
      <div class="superHeader">

        <div class="right">
          <span class="doNotDisplay">Related sites:</span>
          <ul>
            <li><a href="https://github.com/Athas/sigkill.dk">github</a></li>
            
            <li><a href=".././blog/2019-06-30-how-to-make-sway-act-like-ratpoison.md">source</a></li>
            
          </ul>
        </div>

      </div>

      <div class="midHeader">
        <h1 class="headerTitle"><a href="../">SIGKILL <span id="headerSubTitle">-9</span></a></h1>
      </div>

      <div class="subHeader">
        <ul class="menu0"><li><a href="../blog/" class="thisPage">blog/</a></li><li><a href="../hacks/">hacks/</a></li><li><a href="../links.html">links</a></li><li><a href="../me/">me/</a></li><li><a href="../programs/">programs/</a></li><li><a href="../projects/">projects/</a></li><li><a href="../writings/">writings/</a></li></ul>
      </div>
    </div>

    <div id="content">
      <h1>How to make sway act like ratpoison</h1>
<div class="postmetadata">
    Posted on June 30, 2019
</div>

<p><a href="https://github.com/swaywm/sway">Sway</a> is an <a href="https://i3wm.org/">i3</a>-compatible <a href="http://wayland.freedesktop.org/">Wayland</a> compositor. <a href="https://www.nongnu.org/ratpoison/">Ratpoison</a> is a tiling window manager for X11 that is largely modeled after <a href="http://www.gnu.org/software/screen">GNU screen</a>. After a lost couple of years in the <a href="https://en.wikipedia.org/wiki/WIMP_(computing)">WIMPy</a> land of <a href="https://www.gnome.org/">GNOME</a>, I wanted to go back to a tiling window manager on my desktop system. I still wanted to stick to Wayland (<a href="https://www.phoronix.com/scan.php?page=news_item&amp;px=X.Org-Maintenance-Mode-Quickly">X11 is soon becoming retrocomputing</a>), which leaves sway as the only option. However, I have no prior love of i3, and I found the default key shortcuts bad. Specifically, sway assumes that it can be granted an entire modifier key (say, Alt) for key shortcuts. As an example, <code>Alt-f</code> makes a window full screen. A window manager making such assumptions is intolerable in the presence of software like <a href="https://www.gnu.org/software/emacs/">GNU Emacs</a>, which needs all the modifier keys it can get. Returning to <code>Alt-f</code> (or <a href="https://en.wikipedia.org/wiki/Meta_key"><code>M-f</code></a> in Emacs-speak), this shortcut is usually bound to the common command <code>forward-word</code>. One solution is to simply pick a more obscure modifier key, like Super or Hyper, typically in the form of the Windows- or Menu-keys on a modern keyboard. Unfortunately, I use a <a href="https://www.pckeyboard.com/">Unicomp reconstruction of a PS/2 Model M keyboard</a>, which has no such fancy keys.</p>
<p>A much better model of keyboard shortcuts is the one used by programs such as GNU Screen, <a href="https://github.com/tmux/tmux"><code>tmux</code></a>, and ratpoison, where all commands are hidden behind a prefix key. For example, in ratpoison you open a new terminal by first pressing <code>Ctrl-t</code> and then pressing <code>c</code> (without holding down Ctrl). Giving up <code>Ctrl-t</code> (or <code>Ctrl-b</code> for <code>tmux</code>) is a much easier sacrifice than an entire modifier key. Further, the usual convention is to bind the non-modified key to send the captured keypress to the current application (so <code>Ctrl-t t</code> would send <code>Ctrl-t</code>).</p>
<p>Sway is quite configurable, but unfortunately does not seem to support multi-chord keybindings. Fortunately, sway does have a notion of “modes”, much like <code>vi</code>, although in the default configuration the only mode is for resizing windows. With some cleverness, we can use these modes to emulate a prefix key. We will bind <code>Ctrl-t</code> to a command that switches to the prefix mode, where we then bind the actual keys that we care about. However, there is a wrinkle: in sway, once you are in a mode, you <em>stay</em> in that mode. This not what we want: after starting a terminal with <code>Ctrl-t c</code>, we don’t want every subsequent <code>c</code> to start a new terminal! Fortunately, we can bind <code>c</code> to launch the terminal, and then switch back to the “default” mode. We will have to do this for every command, which looks a bit clumsy, but it works well in practice:</p>
<pre><code>mode &quot;prefix&quot; {
    # Launch terminal.
    bindsym c exec $term; mode &quot;default&quot;

    # Send ctrl-t to focused window.
    bindsym t exec xdotool key ctrl+t; mode &quot;default&quot;

    # Kill focused window.
    bindsym k kill; mode &quot;default&quot;

    # return to default mode
    bindsym Control+g mode &quot;default&quot;
    bindsym Return mode &quot;default&quot;
    bindsym Escape mode &quot;default&quot;
}
bindsym Control+t mode &quot;prefix&quot;</code></pre>
<p>The main difference compared to ratpoison is that if you are in the prefix mode and hit a key not associated with a command, that key will be passed to the focused window, and you will stay in prefix mode. Ratpoison would beep at you and exit prefix mode (although it’s strictly not a mode in ratpoison). There is no simple way to capture this behaviour in sway, since you cannot define a “default binding” that would exit the mode.</p>
<p>Still, if you are like me, and consider the early/mid-2000s to be the pinnacle of Unix UI design, then the above produces a quite tolerable experience. My <a href="https://github.com/athas/config/blob/master/sway/config">full sway configuration</a> has more bits and commands, but you should be able to flesh it out yourself. It is not an exact reproduction of ratpoison, nor is it supposed to be: I can accept some measure of progress, as long as I am allowed to keep decades of muscle memory intact.</p>

    </div>

    <div id="footer">
      <a href="http://jaspervdj.be/hakyll/index.html" id="hakyllLink">Powered by Hakyll</a>

      <span id="dates">
        
        
      </span>
    </div>
  </body>
</html>
