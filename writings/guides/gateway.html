<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Quick and dirty GNU/Linux gateway</title>
    <link rel="stylesheet" href="../../css/default.css" type="text/css" media="screen" title="default">
    <link rel="stylesheet" href="../../css/syntax.css" type="text/css">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="description" content="Troels Henriksen's piece of the web.  Mostly about programming.">
    <meta name="keywords" content="Braintwist, Brainfuck, Lisp, Common Lisp Troels Henriksen, Brainfork, Esoteric programming language, programming, Haskell, functional programming, Futhark">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
  </head>
  <body>
    <div id="header">
      <div class="superHeader">

        <div class="right">
          <span class="doNotDisplay">Related sites:</span>
          <ul>
            <li><a href="https://github.com/Athas/sigkill.dk">github</a></li>
            
            <li><a href="../.././writings/guides/gateway.md">source</a></li>
            
          </ul>
        </div>

      </div>

      <div class="midHeader">
        <h1 class="headerTitle"><a href="../../">SIGKILL <span id="headerSubTitle">-9</span></a></h1>
      </div>

      <div class="subHeader">
        <ul class="menu0"><li><a href="../../blog/">blog/</a></li><li><a href="../../hacks/">hacks/</a></li><li><a href="../../links.html">links</a></li><li><a href="../../me/">me/</a></li><li><a href="../../programs/">programs/</a></li><li><a href="../../projects/">projects/</a></li><li><a href="../../writings/" class="thisPage">writings/</a></li></ul><ul class="menu1"><li><a href="../../writings/braces.html">braces</a></li><li><a href="../../writings/flights.html">flights</a></li><li><a href="../../writings/fountain_pens.html">fountain_pens</a></li><li><a href="../../writings/guides/" class="thisPage">guides/</a></li><li><a href="../../writings/languages.html">languages</a></li><li><a href="../../writings/primes.html">primes</a></li><li><a href="../../writings/scripting.html">scripting</a></li><li><a href="../../writings/semicolons.html">semicolons</a></li></ul><ul class="menu2"><li><a href="../../writings/guides/gateway.html" class="thisPage">gateway</a></li><li><a href="../../writings/guides/hakyll.html">hakyll</a></li><li><a href="../../writings/guides/mime.html">mime</a></li><li><a href="../../writings/guides/nixos_pass.html">nixos_pass</a></li><li><a href="../../writings/guides/plan_9_tools.html">plan_9_tools</a></li></ul>
      </div>
    </div>

    <div id="content">
      <h1 id="setting-up-a-quick-and-dirty-gateway-on-gnulinux"><a href="#setting-up-a-quick-and-dirty-gateway-on-gnulinux" id="setting-up-a-quick-and-dirty-gateway-on-gnulinux-link" class="titlelink" title="setting-up-a-quick-and-dirty-gateway-on-gnulinux">Setting up a quick and dirty gateway on GNU/Linux</a></h1>
<p>It’s occasionally useful to set up your GNU/Linux system to function as an Internet gateway for other machines. In particular, when installing a new operating system on a laptop, the only network in range may be an encrypted WLAN for which the installer does not have drivers. In such a case, connect the laptop (the <em>client</em>) to another machine (the <em>gateway</em>) via an ethernet cable and follow this guide. I will assume that the client and gateway are connected to each other through the <code>eth0</code> interface, and that the gateway is connected to the Internet through <code>wlan0</code>.</p>
<p>Finally, note that I’m not much of a system administrator. Don’t use a setup this crude for anything but ad-hoc short-term purposes.</p>
<h2 id="gateway-setup"><a href="#gateway-setup" id="gateway-setup-link" class="titlelink" title="gateway-setup">Gateway setup</a></h2>
<p>Run <a href="gateway.sh">this script</a> on the gateway as root. It sets up the actual forwarding and NATing in the kernel. You will need to have the <code>iptable_nat</code> kernel module loaded.</p>
<p>Then statically assign the gateway an IP adress on the <code>eth0</code> interface:</p>
<pre><code># ifconfig eth0 10.0.0.1</code></pre>
<h2 id="client-setup"><a href="#client-setup" id="client-setup-link" class="titlelink" title="client-setup">Client setup</a></h2>
<p>First, statically assign an IP adress by running the following command on the client.</p>
<pre><code># ifconfig eth0 10.0.0.2</code></pre>
<p>You should be able to ping the gateway now. Try it with <code>ping 10.0.0.1</code>.</p>
<p>Now we must add the IP address of the gateway to the kernel routing table.</p>
<pre><code># route add default gw 10.0.0.1</code></pre>
<p>Finally, you will probably want to be able to perform DNS lookups on the client, so you should add the IP address of Googles free DNS server to the file <code>/etc/resolv.conf</code>.</p>
<pre><code># echo nameserver 8.8.8.8 &gt; /etc/resolv.conf</code></pre>
<p>And that’s it.</p>
<h2 id="dhcp-server"><a href="#dhcp-server" id="dhcp-server-link" class="titlelink" title="dhcp-server">DHCP server</a></h2>
<p>The above is a pretty crude setup, in particular because you have to manually setup the client. Sometimes, you may not be able to interact with the client (it may have no keyboard, or screen). Yet still, most machines have DHCP clients attached to their network interfaces, so if you run a DHCP server on the gateway, you’ll be able to give it a known IP address. Install the program <code>dhcpd</code> and create an <code>/etc/dhcpd.conf</code> file containing:</p>
<pre><code>subnet 10.0.0.0 netmask 255.255.255.0 {
  range 10.0.0.10 10.0.0.20;
}</code></pre>
<p>This will give an IP address in the interval <code>10.0.0.10</code> to <code>10.0.0.20</code> to anyone making a request. Run the DHCP server as so:</p>
<pre><code># dhcpd -d -f eth0</code></pre>
<p>This will run the DHCP server in the foreground and send logging output to standard error, so you’ll be able to tell which IP address is given to the client.</p>
    </div>

    <div id="footer">
      <a href="http://jaspervdj.be/hakyll/index.html" id="hakyllLink">Powered by Hakyll</a>

      <span id="dates">
        
        
      </span>
    </div>
  </body>
</html>
